---
- hosts: primary
  tasks:
    - name: Get docker-compose logs
      shell: docker-compose logs --no-color
      args:
        chdir: "{{ ansible_user_dir }}/tripleo-ci-reproducer"
        executable: /bin/bash
      changed_when: false
      register: docker_compose_log
      tags:
        # We need to run on "shell" module to get docker-compose path from pip
        - skip_ansible_lint

    - name: Dump docker-compose log to a file
      copy:
        content: "{{ docker_compose_log.stdout }}"
        dest: "{{ ansible_user_dir }}/tripleo-ci-reproducer/docker-compose.log"

    - name: Copy files from {{ ansible_user_dir }} on node to log
      synchronize:
        src: '{{ ansible_user_dir }}/tripleo-ci-reproducer/'
        dest: '{{ zuul.executor.log_root }}/tripleo-ci-reproducer/'
        mode: pull
        copy_links: true
        verify_host: true
