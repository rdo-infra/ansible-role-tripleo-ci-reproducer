---
- job:
    name: tripleo-ci-reproducer
    parent: tripleo-ci-reproducer-base
    abstract: true
    description: |
      To test reproducer
    pre-run:
      - playbooks/tripleo-ci-reproducer/pre.yaml
    run: playbooks/tripleo-ci-reproducer/run.yaml
    post-run:
      - playbooks/tripleo-ci-reproducer/post.yaml
    required-projects:
      - rdo-infra/ansible-role-tripleo-ci-reproducer
    timeout: 3600
    vars:
      upstream_gerrit_user: os-tripleo-ci
      rdo_gerrit_user: os-tripleo-ci
      ci_job: hello_job
      reproducer_role_top_dir: >-
        {{ ansible_user_dir }}/{{ zuul.projects[
          'review.rdoproject.org/rdo-infra/ansible-role-tripleo-ci-reproducer'
          ].src_dir }}

- job:
    name: tripleo-ci-reproducer-host
    abstract: true
    parent: tripleo-ci-reproducer
    vars:
      nodepool_provider: host

- job:
    name: tripleo-ci-reproducer-libvirt
    abstract: true
    parent: tripleo-ci-reproducer
    timeout: 7200
    vars:
      nodepool_provider: libvirt
    required-projects:
      - openstack/tripleo-quickstart

- job:
    name: tripleo-ci-reproducer-fedora-28-host
    parent: tripleo-ci-reproducer-host
    nodeset: single-fedora-28-node

- job:
    name: tripleo-ci-reproducer-centos-7-host
    parent: tripleo-ci-reproducer-host
    nodeset: single-centos-7-node

- job:
    name: tripleo-ci-reproducer-fedora-28-libvirt
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-fedora-28-node
    voting: false

- job:
    name: tripleo-ci-reproducer-centos-7-libvirt
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-centos-7-node
    voting: false

- job:
    name: tripleo-ci-reproducer-fedora-28-libvirt-standalone-dryrun
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-fedora-28-node
    voting: false
    vars:
      ci_job: standalone-dryrun

- job:
    name: tripleo-ci-reproducer-fedora-28-libvirt-promotion
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-fedora-28-node
    voting: false
    vars:
      gerrit_image: gerritcodereview/gerrit
      zk_image: zookeeper
      mariadb_image: mariadb
      zuul_image: zuul/zuul
      zuul_scheduler_image: zuul/zuul-scheduler
      zuul_web_image: zuul/zuul-web
      zuul_executor_image: zuul/zuul-executor
      nodepool_launcher_image: zuul/nodepool-launcher
      zuul_merger_image: zuul/zuul-merger
      zuul_fingergw_image: zuul/zuul-fingergw
      logs_image: httpd

- job:
    name: tripleo-ci-reproducer-fedora-28-libvirt-standalone-dryrun-promotion
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-fedora-28-node
    voting: false
    vars:
      ci_job: standalone-dryrun
      gerrit_image: gerritcodereview/gerrit
      zk_image: zookeeper
      mariadb_image: mariadb
      zuul_image: zuul/zuul
      zuul_scheduler_image: zuul/zuul-scheduler
      zuul_web_image: zuul/zuul-web
      zuul_executor_image: zuul/zuul-executor
      nodepool_launcher_image: zuul/nodepool-launcher
      zuul_merger_image: zuul/zuul-merger
      zuul_fingergw_image: zuul/zuul-fingergw
      logs_image: httpd


- project:
    name: rdo-infra/ansible-role-tripleo-ci-reproducer
    check:
      jobs:
        - tox-linters
        - tripleo-ci-reproducer-fedora-28-host
        - tripleo-ci-reproducer-centos-7-host
        - tripleo-ci-reproducer-centos-7-libvirt
        - tripleo-ci-reproducer-fedora-28-libvirt-standalone-dryrun
        - tripleo-ci-reproducer-fedora-28-libvirt-promotion
        - tripleo-ci-reproducer-fedora-28-libvirt-standalone-dryrun-promotion
    gate:
      jobs:
        - tox-linters
        - tripleo-ci-reproducer-fedora-28-host
        - tripleo-ci-reproducer-centos-7-host
