---
- job:
    name: tripleo-ci-reproducer
    parent: tripleo-ci-reproducer-base
    abstract: true
    description: |
      To test reproducer
    pre-run:
      - playbooks/tripleo-ci-reproducer/pre.yaml
    run: playbooks/tripleo-ci-reproducer/run.yaml
    post-run:
      - playbooks/tripleo-ci-reproducer/post.yaml
    required-projects:
      - rdo-infra/ansible-role-tripleo-ci-reproducer
    timeout: 3600
    vars:
      upstream_gerrit_user: os-tripleo-ci
      rdo_gerrit_user: os-tripleo-ci
      reproducer_role_top_dir: >-
        {{ ansible_user_dir }}/{{ zuul.projects[
          'review.rdoproject.org/rdo-infra/ansible-role-tripleo-ci-reproducer'
          ].src_dir }}

- job:
    name: tripleo-ci-reproducer-host
    abstract: true
    parent: tripleo-ci-reproducer
    vars:
      nodepool_provider: host

- job:
    name: tripleo-ci-reproducer-libvirt
    abstract: true
    parent: tripleo-ci-reproducer
    timeout: 7200
    vars:
      nodepool_provider: libvirt
    required-projects:
      - openstack/tripleo-quickstart

- job:
    name: tripleo-ci-reproducer-fedora-28-host
    parent: tripleo-ci-reproducer-host
    nodeset: single-fedora-28-node

- job:
    name: tripleo-ci-reproducer-centos-7-host
    parent: tripleo-ci-reproducer-host
    nodeset: single-centos-7-node

- job:
    name: tripleo-ci-reproducer-fedora-28-libvirt
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-fedora-28-node
    voting: false

- job:
    name: tripleo-ci-reproducer-centos-7-libvirt
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-centos-7-node
    voting: false

- job:
    name: tripleo-ci-reproducer-centos-7-libvirt-standalone
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-centos-7-node
    voting: false
    vars:
        ci_zuul_yaml:
            - project:
                check:
                  jobs:
                    - tripleo-ci-centos-7-containers-multinode-dlrn-hash-tag

            - job:
                name: tripleo-ci-centos-7-containers-multinode-dlrn-hash-tag
                parent: tripleo-ci-centos-7-containers-multinode
                vars:
                  ready_releases_file: |
                    #!/bin/env bash
                    export UNDERCLOUD_INSTALL_RELEASE="master"
                    export UNDERCLOUD_INSTALL_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export UNDERCLOUD_TARGET_RELEASE="master"
                    export UNDERCLOUD_TARGET_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export OVERCLOUD_DEPLOY_RELEASE="master"
                    export OVERCLOUD_DEPLOY_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export OVERCLOUD_TARGET_RELEASE="master"
                    export OVERCLOUD_TARGET_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export STANDALONE_DEPLOY_RELEASE="master"
                    export STANDALONE_DEPLOY_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export STANDALONE_DEPLOY_NEWEST_HASH="eaf6d8d95d4f3badb071ee9e4cdf9a6652ada69b_156a4cd0"
                    export STANDALONE_TARGET_RELEASE="master"
                    export STANDALONE_TARGET_NEWEST_HASH="eaf6d8d95d4f3badb071ee9e4cdf9a6652ada69b_156a4cd0"
                    export STANDALONE_TARGET_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                  featureset_override:
                    dlrn_hash_tag:
                      591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1
                    dlrn_hash_tag_newest:
                      eaf6d8d95d4f3badb071ee9e4cdf9a6652ada69b_156a4cd0

- job:
    name: tripleo-ci-reproducer-fedora-28-libvirt-standalone
    parent: tripleo-ci-reproducer-libvirt
    nodeset: single-fedora-28-node
    voting: false
    vars:
        ci_zuul_yaml:
            - project:
                check:
                  jobs:
                    - tripleo-ci-centos-7-containers-multinode-dlrn-hash-tag

            - job:
                name: tripleo-ci-centos-7-containers-multinode-dlrn-hash-tag
                parent: tripleo-ci-centos-7-containers-multinode
                vars:
                  ready_releases_file: |
                    #!/bin/env bash
                    export UNDERCLOUD_INSTALL_RELEASE="master"
                    export UNDERCLOUD_INSTALL_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export UNDERCLOUD_TARGET_RELEASE="master"
                    export UNDERCLOUD_TARGET_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export OVERCLOUD_DEPLOY_RELEASE="master"
                    export OVERCLOUD_DEPLOY_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export OVERCLOUD_TARGET_RELEASE="master"
                    export OVERCLOUD_TARGET_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export STANDALONE_DEPLOY_RELEASE="master"
                    export STANDALONE_DEPLOY_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                    export STANDALONE_DEPLOY_NEWEST_HASH="eaf6d8d95d4f3badb071ee9e4cdf9a6652ada69b_156a4cd0"
                    export STANDALONE_TARGET_RELEASE="master"
                    export STANDALONE_TARGET_NEWEST_HASH="eaf6d8d95d4f3badb071ee9e4cdf9a6652ada69b_156a4cd0"
                    export STANDALONE_TARGET_HASH="591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1"
                  featureset_override:
                    dlrn_hash_tag:
                      591f43c8256ea27cd9de20269bbd5f5604874e0a_8e97d5e1
                    dlrn_hash_tag_newest:
                      eaf6d8d95d4f3badb071ee9e4cdf9a6652ada69b_156a4cd0

- project:
    name: rdo-infra/ansible-role-tripleo-ci-reproducer
    check:
      jobs:
        - tox-linters
        - tripleo-ci-reproducer-fedora-28-host
        - tripleo-ci-reproducer-centos-7-host
        - tripleo-ci-reproducer-fedora-28-libvirt
        - tripleo-ci-reproducer-centos-7-libvirt
        - tripleo-ci-reproducer-fedora-28-libvirt-standalone
        - tripleo-ci-reproducer-centos-7-libvirt-standalone
    gate:
      jobs:
        - tox-linters
        - tripleo-ci-reproducer-fedora-28-host
        - tripleo-ci-reproducer-centos-7-host
        - tripleo-ci-reproducer-fedora-28-libvirt
